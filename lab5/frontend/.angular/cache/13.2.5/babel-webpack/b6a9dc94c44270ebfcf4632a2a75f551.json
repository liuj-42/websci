{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"../http.service\";\nexport let LoggedinComponent = /*#__PURE__*/(() => {\n  class LoggedinComponent {\n    constructor(httpService) {\n      this.httpService = httpService;\n      this.name = \"\";\n      this.product = \"\";\n      this.recent = null;\n      this.gotSongs = false;\n      this.refresh_token = \"\";\n    }\n\n    ngOnInit() {\n      let access_token = searchParams.get(\"access_token\");\n      this.refresh_token = searchParams.get(\"refresh_token\");\n      this.getInfo(access_token);\n      this.getRecent(access_token);\n    }\n\n    getInfo(token) {\n      this.httpService.getRequest(`http://localhost:3000/info?token=${token}`).subscribe(data => {\n        console.log(data);\n        let one = JSON.stringify(data);\n        let two = JSON.parse(one);\n        this.name = two[\"display_name\"];\n        this.product = two[\"product\"];\n      });\n    }\n\n    getRecent(token) {\n      this.httpService.getRequest(`http://localhost:3000/recent?token=${token}`).subscribe(data => {\n        this.populate_recently_played(data);\n        this.gotSongs = true;\n      });\n    }\n\n    populate_recently_played(zero) {\n      let one = JSON.stringify(zero);\n      let data = JSON.parse(one);\n      let tracks = data[\"items\"];\n      let out = \"<ul id='recent' class='list_'>\";\n      tracks.forEach(element => {\n        out += '<li class=\"list_item\">';\n        out += \"<div class='card-horizontal'>\";\n        out += `<div class=\"img-square-wrapper\"> <img class=\"thumbnail\" width=\"200px\" src=\"${element[\"track\"][\"album\"][\"images\"][\"1\"][\"url\"]}\" alt=\"album art\"></div>`;\n        out += '<div class=\"card-body\">';\n        out += `<h4 class=\"card-title song\">Song name: ${element[\"track\"][\"name\"]}</h4>`;\n        out += '<span class=\"not-liked\" onclick=\"addLike(this)\">&nbsp;</span>';\n        out += `<span class=\"artists card-text\">Artist(s): `;\n        element[\"track\"][\"artists\"].forEach(artist => {\n          out += `<a href=\"https://open.spotify.com/artist/5WmX340gDNLIAyUcg4MzWN${artist[\"id\"]}\">${artist[\"name\"]} </a>`;\n        });\n        out += `</span><p class=\"album card-text\">Album: ${element[\"track\"][\"album\"][\"name\"]}</p>`;\n        out += `<span class=\"addToPlaylist\" onclick=\"alert('added to playlist')\">Add to a playlist</span>`; // POST here\n\n        out += `<p class=\"card-footer\">Played ${this.parse(element[\"played_at\"])} ago</p>`;\n        out += `</div>`;\n        out += \"</div>\";\n        out += '</li>';\n      });\n      out += \"</ul>\";\n      let recently_played = document.getElementById(\"recently-played\");\n      recently_played.innerHTML = out;\n    }\n\n    parse(date) {\n      let timestamp = Date.parse(date);\n      let diff = Math.floor((Date.now() - timestamp) / 1000);\n\n      if (diff < 60) {\n        return `${diff} seconds`;\n      } else if (diff < 3600) {\n        return `${Math.floor(diff / 60)} minute${Math.floor(diff / 60) === 1 ? \"\" : \"s\"}`;\n      } else if (diff < 86400) {\n        return `${Math.floor(diff / 3600)} hour${Math.floor(diff / 3600) === 1 ? \"\" : \"s\"}`;\n      } else {\n        return `${Math.floor(diff / 86400)} day${Math.floor(diff / 86400) === 1 ? \"\" : \"s\"}`;\n      }\n    }\n\n    getCall(url) {\n      this.httpService.getRequest(`http://localhost:3000/${url}`).subscribe(data => {\n        console.log(data);\n        return data;\n      });\n    }\n\n  }\n\n  LoggedinComponent.ɵfac = function LoggedinComponent_Factory(t) {\n    return new (t || LoggedinComponent)(i0.ɵɵdirectiveInject(i1.HttpService));\n  };\n\n  LoggedinComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: LoggedinComponent,\n    selectors: [[\"app-loggedin\"]],\n    inputs: {\n      name: \"name\",\n      product: \"product\",\n      recent: \"recent\"\n    },\n    decls: 3,\n    vars: 2,\n    consts: [[\"id\", \"recently-played\"]],\n    template: function LoggedinComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"h1\");\n        i0.ɵɵtext(1);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(2, \"div\", 0);\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵtextInterpolate2(\"Signed in as \", ctx.name, \". You are a \", ctx.product, \" user\");\n      }\n    },\n    styles: [\"\"]\n  });\n  return LoggedinComponent;\n})();\nlet searchParams = new URLSearchParams(window.location.search);","map":null,"metadata":{},"sourceType":"module"}